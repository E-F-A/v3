# +---------------------------------------------------+
# Function to ask and set MalwarePatrol Receipt Key
# +---------------------------------------------------+
function func_ask-malwarepatrol() {
  func_echo-header
  echo -e "$green[EFA]$clean - Set MalwarePatrol Receipt Key"
  echo -e ""
  echo -e "$green[EFA]$clean This option will allow you to set the MalwarePatrol "
  echo -e "$green[EFA]$clean receipt key for a MalwarePatrol subscription."
  echo -e ""
  CURRENTMPRECEIPT=$(grep "^mbl_receipt=" /usr/local/etc/clamav-unofficial-sigs.conf | awk -F'=' '{print $2}' | tr -d '"')
  echo -e "Current MalwarePatrol Receipt Key: $CURRENTMPRECEIPT"
  echo -e ""

  while [ "1" == "1" ]
    do  
      echo -e "Choose an option:"
      echo -e "1) Modify receipt key"
      echo -e ""
      echo -e "e) Return to main menu"
      echo -e ""
      echo -e -n "$green[EFA]$clean : "
      local choice
      read choice
      case $choice in
                1) 
                 FLAG=1
                  while [ $FLAG -eq 1 ]
                    do
                      echo ""
                      echo -e -n "$green[EFA]$clean Enter your new MalwarePatrol Receipt Key: "
                      read MPRECEIPT
                      if [[ $MPRECEIPT =~ [A-Za-z0-9]+ ]]; then 
                        sed -i "/^mbl_receipt=/ c\mbl_receipt=\"$MPRECEIPT\"" /usr/local/etc/clamav-unofficial-sigs.conf
                        echo -e "$green[EFA]$clean MalwarePatrol Receipt key set"
                        FLAG=0
                      elif [[ -z $MPRECEIPT ]]; then
                        sed -i "/^mbl_receipt=/ c\mbl_receipt=\"\"" /usr/local/etc/clamav-unofficial-sigs.conf
                        echo -e "$green[EFA]$clean MalwarePatrol Receipt key erased."
                        FLAG=0
                      else
                        echo -e "$red[ERROR]$clean Invalid receipt key.  Key must be alphanumeric and not contain special characters."
                      fi   
                    done 
                    sleep 2
                    return ;;
                e) return ;;
                *) echo -e "Error \"$choice\" is not an option..." && sleep 2
      esac
    done
}