######################################################################
# EFA 3.0.2.3 RELEASE NOTES
######################################################################
# Copyright (C) 2015-2017  https://efa-project.org
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#######################################################################

Welcome to EFA Version 3.0.2.3!

Many thanks goes to the developers of EFA and maintainers of all
3rd party packages!

These release notes will help guide you through the 3.0.2.3 update.

Many fixes and enhancements have been made to EFA.  Please review the
CHANGELOG for further information.

https://raw.githubusercontent.com/E-F-A/v3/3.0.2.3/CHANGELOG

###################### How To Update ##################################

It is recommended that you suspend your mail flow and snapshot prior
to updating or to back up the entire appliance.

1) Stop mail flow temporarily (at firewalls/mailservers)
2) Snapshot your VM and its memory using your hypervisor tools
3) If the update fails for any reason, collect relevant logs or screen
outputs/screenshots and revert to your snapshot
4) Report failure at https://forum.efa-project.org

Launch EFA-Configure from console or secure shell

(sudo /usr/local/sbin/EFA-Configure)

Choose option 14) Update Now

The first time you run this update, the kernel may update. If this
happens, the script will halt to give you an opportunity to restart.
After restarting and booting to the new kernel, rerun EFA-Update to
continue the update process to 3.0.2.3.

EFA-Update will not proceed until you are running on the latest
kernel.  This is to ensure that open-vm-tools updates appropriately
if present.

#######################################################################

#################### Important Security Notice ########################

///Everyone is STRONGLY encouraged to update from 3.0.1.8 and below NOW\\\

A recent set of vulnerabilities have been discovered in the MailWatch and
SGWI interfaces that can allow an attacker to escalate privileges in eFa.

Because of these vulnerabilities, if you are using the same password for
the console as you are for MailWatch (many folks are), please take a moment
to make your MailWatch admin password different from the console.
Doing so will limit the success of a shared credential attack via MailWatch
on eFa to gain root access.

If you cannnot update or have problems, the following steps are
strongly recommended to keep your appliance safe until you can update
successfully:

1) Rotate your admin passwords in the console and MailWatch UI and make
   each one different than the other to prevent a shared credential
   attack.

2) Install mod_security and mod_evasive to provide some security in front
   of the vulnerable code.

3) Inform your MailWatch users (especially admins) to avoid opening multiple
   tabs and performing general web browsing while working in MailWatch

##################### Important database changes ######################

MailWatch 1.2.1 and newer has utf8mb4 character set support.
CentOS 6.9 lacks this support in the stock mysql rpms.
Therefore, upgrades from 3.0.1.8 and below will migrate the database
from mysql to MariaDB 10.1.  This may be a big jump for some users and
may want to perform additional testing prior to upgrading.

################ Important Info -- Custom Tweaks ######################

Many EFA users have modified their EFA installations and made tweaks
that may "disappear" after an update to 3.0.2.3.

Updated files have been automatically backed up to the following
location:

/var/EFA/backup/

(Other versions may be present if updating from an older version)

########################## Known Issues ###############################

1)  If you are running commercial VMware-Tools, open-vm-tools may
install itself after updating to 3.0.2.3.  Reapply VMware-Tools
after updating to 3.0.2.3.  Run the following command to remove
open-vm-tools:

sudo rpm -e open-vm-tools

2) Error, "could not search" when logging into MailWatch after
updating to 3.0.2.3.

This occurs when Active Directory integration is enabled.

Check /var/www/html/mailscanner/conf.php

Change the following line to 'mail' from 'proxyaddresses', if needed...
define('LDAP_EMAIL_FIELD', 'proxyaddresses');

Change the following
define('LDAP_MS_AD_COMPATIBILITY', true);

3) EFA-Update hanging at end of update (logsave not exiting)

This is a known issue.  This is usually caused from processes that
spawned off of the script and have not closed.

You can kill the logsave process (Ctrl+C if running interactively)

5) Updating with multiple AV Scanners present

Starting with update 3.0.1.2, MailScanner has undergone a major upgrade to v5.

Notice:  Some commercial virus scanners may not have wrappers in v5. If this 
affects you, please reach out to mailscanner via the mailscanner listserv forum for
further assistance.

One of the changes includes the introduction of a new group called "mtagroup."

You may see MailScanner failing to scan emails as a result of the upgrade or a scanning loop occurring.

If you are running any 3rd party antivirus scanners, please be sure to add the users to the mtagroup:

sudo usermod someavaccount -G mtagroup

An AV daemon restart and/or a reboot may be needed for the change to take effect.

#######################################################################

########################## Reporting Issues ###########################

Please visit https://forum.efa-project.org and report bugs under the
3.x Bugs forum.

#######################################################################
